#!/usr/bin/env php
<?php

/**
 * A Simple PHP MVC
 * Created by: Albet Novendo
 * File: ASMVC CLI
 * ASMVC is licensed under MIT.
 * Contribution: https://github.com/albetnov/simple-php-mvc
 */

use Albet\Asmvc\Core\CliParser;

/**
 * Define that ASMVC Cli is started.
 */
define('ASMVC_CLI_START', true);

/**
 * Calling autoload. If it's not exist. Install composer's autoload.
 */
if (is_dir(__DIR__ . '/vendor/')) {
    require_once __DIR__ . '/App/Core/bootstrap.php';
    $install = false;
} else {
    echo "ASMVC will try to install dependencies by running composer install...\n";
    $install = true;
}
require_once __DIR__ . '/App/Core/Helpers.php';
require_once __DIR__ . '/App/Core/Cli/Cli.php';
require_once __DIR__ . '/App/Core/CliParser.php';

/**
 * Validate that ASMVC must be running by CLI interface only.
 */
if (PHP_SAPI !== 'cli') {
    exit('ASMVC Only limited to run in CLI Environment Only' . PHP_EOL);
}

/**
 * Parsing the argument written by user.
 */
$cli = new CliParser;
if ($install) {
    $cli->install();
} else {
    (new \NunoMaduro\Collision\Provider)->register();
    $cli->argument_parse($argv);
}
